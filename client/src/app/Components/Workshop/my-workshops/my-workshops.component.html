<div class="relative p-6">
  <div *ngIf="error" class="bg-red-50 text-red-800 p-4 rounded-xl mb-6 text-center shadow-md">{{ error }}</div>
  <div *ngIf="success" class="bg-green-50 text-green-800 p-4 rounded-xl mb-6 text-center shadow-md">{{ success }}</div>

  <div *ngIf="isLoading" class="flex justify-center">
    <div class="border-t-4 border-orange-600 border-solid w-8 h-8 rounded-full animate-spin"></div>
  </div>

  <div *ngIf="!isLoading">
    <h2 class="text-2xl font-bold text-gray-700 mb-6">Mes Workshops</h2>
    <div *ngIf="workshops.length === 0" class="text-center text-gray-600">
      Vous n'êtes inscrit à aucun workshop.
    </div>
    <div *ngIf="workshops.length > 0" class="mb-6">
      <label for="workshopSelect" class="block text-sm font-medium text-gray-700 mb-2">Sélectionner un Workshop</label>
      <select
        id="workshopSelect"
        [(ngModel)]="selectedWorkshop"
        (ngModelChange)="selectWorkshop($event)"
        class="block w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-600 focus:border-blue-600"
      >
        <option value="">-- Choisir un Workshop --</option>
        <option *ngFor="let workshop of workshops; trackBy: trackByFn" [value]="workshop.workshopId._id">
          {{ workshop.workshopId.title }}
        </option>
      </select>
    </div>

    <div *ngIf="selectedWorkshop && tasks.length > 0 && currentTaskIndex < tasks.length" class="mb-6">
      <h4 class="text-lg font-semibold text-gray-700 mb-4">Tâche {{ currentTaskIndex + 1 }}: {{ tasks[currentTaskIndex].title }}</h4>
      <div class="p-4 bg-gray-50 rounded-xl">
        <p class="text-gray-600 whitespace-pre-wrap break-words">{{ tasks[currentTaskIndex].content }}</p>
        <p class="text-sm text-gray-500 mt-2">Créée le: {{ tasks[currentTaskIndex].createdAt | date:'short' }}</p>
        <button
          (click)="markTaskAsRead()"
          class="mt-4 px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl hover:from-orange-700 hover:to-orange-800 transition duration-300"
        >
          Marquer comme lu
        </button>
      </div>
    </div>
  </div>

  <!-- Quiz Modal -->
  <div *ngIf="showQuizModal && currentQuiz" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl p-8 w-full max-w-lg max-h-[80vh] overflow-y-auto">
      <h3 class="text-2xl font-bold text-gray-700 mb-6">Quiz: {{ currentQuiz.title }}</h3>
      <form>
        <div *ngFor="let question of currentQuiz.questions; let i = index" class="mb-4">
          <p class="font-medium text-gray-700">{{ i + 1 }}. {{ question.question }}</p>
          <div *ngFor="let option of question.options; let j = index" class="ml-4">
            <label class="flex items-center">
              <input
                type="radio"
                [name]="'question-' + i"
                [value]="option"
                [(ngModel)]="answers[question._id]"
                class="mr-2"
              />
              {{ option }}
            </label>
          </div>
        </div>
        <div class="flex gap-4">
          <button
            type="button"
            (click)="submitQuiz()"
            [disabled]="isLoading"
            class="flex-1 py-2 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-xl hover:from-orange-700 hover:to-orange-800 transition duration-300 disabled:opacity-60"
          >
            Soumettre
          </button>
          <button
            type="button"
            (click)="closeQuizModal()"
            class="flex-1 py-2 bg-gray-300 text-gray-700 rounded-xl hover:bg-gray-400 transition duration-300"
          >
            Quitter
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
